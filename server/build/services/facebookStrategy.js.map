{"version":3,"sources":["../../src/services/facebookStrategy.js"],"names":["serverUrl","process","env","NODE_ENV","SERVER_URL_PROD","SERVER_URL_DEV","facebookLogin","FacebookStrategy","clientID","FACEBOOK_APP_ID","clientSecret","FACEBOOK_SECRET","callbackURL","FACEBOOK_CALLBACK_URL","profileFields","accessToken","refreshToken","profile","done","oldUser","User","findOne","email","emails","value","err","console","log","newUser","provider","facebookId","id","username","name","displayName","avatar","photos","save","passport","use"],"mappings":";;AAAA;;AACA;;AAEA;;;;AAEA,MAAMA,SAAS,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwCF,OAAO,CAACC,GAAR,CAAYE,eAApD,GAAsEH,OAAO,CAACC,GAAR,CAAYG,cAApG,C,CAEA;;AACA,MAAMC,aAAa,GAAG,IAAIC,0BAAJ,CACpB;AACEC,EAAAA,QAAQ,EAAEP,OAAO,CAACC,GAAR,CAAYO,eADxB;AAEEC,EAAAA,YAAY,EAAET,OAAO,CAACC,GAAR,CAAYS,eAF5B;AAGEC,EAAAA,WAAW,EAAG,GAAEZ,SAAU,GAAEC,OAAO,CAACC,GAAR,CAAYW,qBAAsB,EAHhE;AAIEC,EAAAA,aAAa,EAAE,CACb,IADa,EAEb,OAFa,EAGb,QAHa,EAIb,YAJa,EAKb,aALa,EAMb,QANa,EAOb,MAPa,EAQb,UARa,EASb,cATa,EAUb,UAVa,EAWb,qBAXa;AAJjB,CADoB,EAmBpB,OAAOC,WAAP,EAAoBC,YAApB,EAAkCC,OAAlC,EAA2CC,IAA3C,KAAoD;AAClD;AACA,MAAI;AACF,UAAMC,OAAO,GAAG,MAAMC,cAAKC,OAAL,CAAa;AAAEC,MAAAA,KAAK,EAAEL,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC;AAA3B,KAAb,CAAtB;;AAEA,QAAIL,OAAJ,EAAa;AACX,aAAOD,IAAI,CAAC,IAAD,EAAOC,OAAP,CAAX;AACD;AACF,GAND,CAME,OAAOM,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,GAViD,CAYlD;;;AACA,MAAI;AACF,UAAMG,OAAO,GAAG,MAAM,IAAIR,aAAJ,CAAS;AAC7BS,MAAAA,QAAQ,EAAE,UADmB;AAE7BC,MAAAA,UAAU,EAAEb,OAAO,CAACc,EAFS;AAG7BC,MAAAA,QAAQ,EAAG,OAAMf,OAAO,CAACc,EAAG,EAHC;AAI7BT,MAAAA,KAAK,EAAEL,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC,KAJI;AAK7BS,MAAAA,IAAI,EAAEhB,OAAO,CAACiB,WALe;AAM7BC,MAAAA,MAAM,EAAElB,OAAO,CAACmB,MAAR,CAAe,CAAf,EAAkBZ;AANG,KAAT,EAOnBa,IAPmB,EAAtB;AASAnB,IAAAA,IAAI,CAAC,IAAD,EAAOU,OAAP,CAAJ;AACD,GAXD,CAWE,OAAOH,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,CA9CmB,CAAtB;;AAiDAa,kBAASC,GAAT,CAAajC,aAAb","sourcesContent":["import passport from 'passport';\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\n\nimport User from '../models/User';\n\nconst serverUrl = process.env.NODE_ENV === 'production' ? process.env.SERVER_URL_PROD : process.env.SERVER_URL_DEV;\n\n// facebook strategy\nconst facebookLogin = new FacebookStrategy(\n  {\n    clientID: process.env.FACEBOOK_APP_ID,\n    clientSecret: process.env.FACEBOOK_SECRET,\n    callbackURL: `${serverUrl}${process.env.FACEBOOK_CALLBACK_URL}`,\n    profileFields: [\n      'id',\n      'email',\n      'gender',\n      'profileUrl',\n      'displayName',\n      'locale',\n      'name',\n      'timezone',\n      'updated_time',\n      'verified',\n      'picture.type(large)',\n    ],\n  },\n  async (accessToken, refreshToken, profile, done) => {\n    // console.log(profile);\n    try {\n      const oldUser = await User.findOne({ email: profile.emails[0].value });\n\n      if (oldUser) {\n        return done(null, oldUser);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    // register user\n    try {\n      const newUser = await new User({\n        provider: 'facebook',\n        facebookId: profile.id,\n        username: `user${profile.id}`,\n        email: profile.emails[0].value,\n        name: profile.displayName,\n        avatar: profile.photos[0].value,\n      }).save();\n\n      done(null, newUser);\n    } catch (err) {\n      console.log(err);\n    }\n  },\n);\n\npassport.use(facebookLogin);\n"],"file":"facebookStrategy.js"}