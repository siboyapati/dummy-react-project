{"version":3,"sources":["../../src/services/googleStrategy.js"],"names":["serverUrl","process","env","NODE_ENV","SERVER_URL_PROD","SERVER_URL_DEV","googleLogin","GoogleStrategy","clientID","GOOGLE_CLIENT_ID","clientSecret","GOOGLE_CLIENT_SECRET","callbackURL","GOOGLE_CALLBACK_URL","proxy","accessToken","refreshToken","profile","done","oldUser","User","findOne","email","err","console","log","newUser","provider","googleId","id","username","name","displayName","avatar","picture","save","passport","use"],"mappings":";;AAAA;;AACA;;AAEA;;;;AAEA,MAAMA,SAAS,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwCF,OAAO,CAACC,GAAR,CAAYE,eAApD,GAAsEH,OAAO,CAACC,GAAR,CAAYG,cAApG,C,CAEA;;AACA,MAAMC,WAAW,GAAG,IAAIC,6BAAJ,CAClB;AACEC,EAAAA,QAAQ,EAAEP,OAAO,CAACC,GAAR,CAAYO,gBADxB;AAEEC,EAAAA,YAAY,EAAET,OAAO,CAACC,GAAR,CAAYS,oBAF5B;AAGEC,EAAAA,WAAW,EAAG,GAAEZ,SAAU,GAAEC,OAAO,CAACC,GAAR,CAAYW,mBAAoB,EAH9D;AAIEC,EAAAA,KAAK,EAAE;AAJT,CADkB,EAOlB,OAAOC,WAAP,EAAoBC,YAApB,EAAkCC,OAAlC,EAA2CC,IAA3C,KAAoD;AAClD;AACA,MAAI;AACF,UAAMC,OAAO,GAAG,MAAMC,cAAKC,OAAL,CAAa;AAAEC,MAAAA,KAAK,EAAEL,OAAO,CAACK;AAAjB,KAAb,CAAtB;;AAEA,QAAIH,OAAJ,EAAa;AACX,aAAOD,IAAI,CAAC,IAAD,EAAOC,OAAP,CAAX;AACD;AACF,GAND,CAME,OAAOI,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;;AAED,MAAI;AACF,UAAMG,OAAO,GAAG,MAAM,IAAIN,aAAJ,CAAS;AAC7BO,MAAAA,QAAQ,EAAE,QADmB;AAE7BC,MAAAA,QAAQ,EAAEX,OAAO,CAACY,EAFW;AAG7BC,MAAAA,QAAQ,EAAG,OAAMb,OAAO,CAACY,EAAG,EAHC;AAI7BP,MAAAA,KAAK,EAAEL,OAAO,CAACK,KAJc;AAK7BS,MAAAA,IAAI,EAAEd,OAAO,CAACe,WALe;AAM7BC,MAAAA,MAAM,EAAEhB,OAAO,CAACiB;AANa,KAAT,EAOnBC,IAPmB,EAAtB;AAQAjB,IAAAA,IAAI,CAAC,IAAD,EAAOQ,OAAP,CAAJ;AACD,GAVD,CAUE,OAAOH,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,CAhCiB,CAApB;;AAmCAa,kBAASC,GAAT,CAAa/B,WAAb","sourcesContent":["import passport from 'passport';\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth2';\n\nimport User from '../models/User';\n\nconst serverUrl = process.env.NODE_ENV === 'production' ? process.env.SERVER_URL_PROD : process.env.SERVER_URL_DEV;\n\n// google strategy\nconst googleLogin = new GoogleStrategy(\n  {\n    clientID: process.env.GOOGLE_CLIENT_ID,\n    clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n    callbackURL: `${serverUrl}${process.env.GOOGLE_CALLBACK_URL}`,\n    proxy: true,\n  },\n  async (accessToken, refreshToken, profile, done) => {\n    // console.log(profile);\n    try {\n      const oldUser = await User.findOne({ email: profile.email });\n\n      if (oldUser) {\n        return done(null, oldUser);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    try {\n      const newUser = await new User({\n        provider: 'google',\n        googleId: profile.id,\n        username: `user${profile.id}`,\n        email: profile.email,\n        name: profile.displayName,\n        avatar: profile.picture,\n      }).save();\n      done(null, newUser);\n    } catch (err) {\n      console.log(err);\n    }\n  },\n);\n\npassport.use(googleLogin);\n"],"file":"googleStrategy.js"}