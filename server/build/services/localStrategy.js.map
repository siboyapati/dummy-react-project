{"version":3,"sources":["../../src/services/localStrategy.js"],"names":["passportLogin","PassportLocalStrategy","usernameField","passwordField","session","passReqToCallback","req","email","password","done","error","Joi","validate","body","loginSchema","message","details","user","User","findOne","trim","comparePassword","err","isMatch","passport","use"],"mappings":";;AAAA;;AACA;;AACA;;AAEA;;AACA;;;;AAEA,MAAMA,aAAa,GAAG,IAAIC,uBAAJ,CACpB;AACEC,EAAAA,aAAa,EAAE,OADjB;AAEEC,EAAAA,aAAa,EAAE,UAFjB;AAGEC,EAAAA,OAAO,EAAE,KAHX;AAIEC,EAAAA,iBAAiB,EAAE;AAJrB,CADoB,EAOpB,OAAOC,GAAP,EAAYC,KAAZ,EAAmBC,QAAnB,EAA6BC,IAA7B,KAAsC;AACpC,QAAM;AAAEC,IAAAA;AAAF,MAAYC,aAAIC,QAAJ,CAAaN,GAAG,CAACO,IAAjB,EAAuBC,uBAAvB,CAAlB;;AACA,MAAIJ,KAAJ,EAAW;AACT,WAAOD,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,MAAAA,OAAO,EAAEL,KAAK,CAACM,OAAN,CAAc,CAAd,EAAiBD;AAA5B,KAAd,CAAX;AACD;;AAED,MAAI;AACF,UAAME,IAAI,GAAG,MAAMC,cAAKC,OAAL,CAAa;AAAEZ,MAAAA,KAAK,EAAEA,KAAK,CAACa,IAAN;AAAT,KAAb,CAAnB;;AACA,QAAI,CAACH,IAAL,EAAW;AACT,aAAOR,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,QAAAA,OAAO,EAAE;AAAX,OAAd,CAAX;AACD;;AAEDE,IAAAA,IAAI,CAACI,eAAL,CAAqBb,QAArB,EAA+B,UAAUc,GAAV,EAAeC,OAAf,EAAwB;AACrD,UAAID,GAAJ,EAAS;AACP,eAAOb,IAAI,CAACa,GAAD,CAAX;AACD;;AACD,UAAI,CAACC,OAAL,EAAc;AACZ,eAAOd,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,UAAAA,OAAO,EAAE;AAAX,SAAd,CAAX;AACD;;AAED,aAAON,IAAI,CAAC,IAAD,EAAOQ,IAAP,CAAX;AACD,KATD;AAUD,GAhBD,CAgBE,OAAOK,GAAP,EAAY;AACZ,WAAOb,IAAI,CAACa,GAAD,CAAX;AACD;AACF,CAhCmB,CAAtB;;AAmCAE,kBAASC,GAAT,CAAazB,aAAb","sourcesContent":["import passport from 'passport';\nimport { Strategy as PassportLocalStrategy } from 'passport-local';\nimport Joi from 'joi';\n\nimport User from '../models/User';\nimport { loginSchema } from './validators';\n\nconst passportLogin = new PassportLocalStrategy(\n  {\n    usernameField: 'email',\n    passwordField: 'password',\n    session: false,\n    passReqToCallback: true,\n  },\n  async (req, email, password, done) => {\n    const { error } = Joi.validate(req.body, loginSchema);\n    if (error) {\n      return done(null, false, { message: error.details[0].message });\n    }\n\n    try {\n      const user = await User.findOne({ email: email.trim() });\n      if (!user) {\n        return done(null, false, { message: 'Email does not exists.' });\n      }\n\n      user.comparePassword(password, function (err, isMatch) {\n        if (err) {\n          return done(err);\n        }\n        if (!isMatch) {\n          return done(null, false, { message: 'Incorrect password.' });\n        }\n\n        return done(null, user);\n      });\n    } catch (err) {\n      return done(err);\n    }\n  },\n);\n\npassport.use(passportLogin);\n"],"file":"localStrategy.js"}